<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.house.model.mapper.InfraMapper">
    
    <select id="getCurSchool" parameterType="map" resultType="school">
    	select schCode, schName, lat, lng
    	from (
    		select ( 6371 * acos( cos( radians( #{curlat} ) ) 
            * cos( radians(lat))
            * cos( radians( lng ) - radians(#{curlng}) ) + sin( radians(#{curlat}) ) * sin( radians(lat) ) ) )
            AS distance, schCode, schName, lat, lng
			from school ) data
         where data.distance <![CDATA[<]]>2
    </select>
    
    <select id="getCurBus" parameterType="map" resultType="bus">
    	select busCode, busName, lat, lng
    	from (
    		select ( 6371 * acos( cos( radians( #{curlat} ) ) 
            * cos( radians(lat))
            * cos( radians( lng ) - radians(#{curlng}) ) + sin( radians(#{curlat}) ) * sin( radians(lat) ) ) )
            AS distance, busCode, busName, lat, lng
			from bus ) data
         where data.distance <![CDATA[<]]>1
    </select>
</mapper>